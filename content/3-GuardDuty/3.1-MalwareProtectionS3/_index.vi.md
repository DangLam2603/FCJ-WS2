---
title : "Kích hoạt bảo vệ phần mềm độc hại cho S3"
date : "`r Sys.Date()`"
weight : 1
chapter : false
pre : " <b> 3.1 </b> "
---

#### Kích hoạt tính năng mới
1. Tìm và truy cập dịch vụ **Amazon GuardDuty**
![](/images/3.GuardDuty/3.5-malware.jpg?width=60pc)

1. Chọn S3 bucket cần bảo vệ 
{{% notice info %}}
Bạn có thể chọn **Object with a specific prefix** để tùy chỉnh tiền tố của tệp trong bucket của bạn. Trong dự án này, chúng tôi sẽ quét tất cả các tệp trong bucket.
{{% /notice %}} 
![](/images/3.GuardDuty/3.6.jpg?width=60pc)

1. Chọn tùy chọn ```s3-raw-gd```
![](/images/3.GuardDuty/3.7.jpg?width=60pc)

1. Trong phần **Tag Scan Object**:
   - Chọn **Tag Objects**: điều này cho phép GuardDuty ghi trạng thái quét vào phần thẻ trong các đối tượng S3.
![](/images/3.GuardDuty/3.8.jpg?width=60pc)

1. Trong phần **Permission**, xem xét **Policy** và **Trust Relationship**. 
- Policy
```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowManagedRuleToSendS3EventsToGuardDuty",
      "Effect": "Allow",
      "Action": [
        "events:PutRule",
        "events:DeleteRule",
        "events:PutTargets",
        "events:RemoveTargets"
      ],
      "Resource": [
        "arn:aws:events:ap-southeast-1:381492162967:rule/DO-NOT-DELETE-AmazonGuardDutyMalwareProtectionS3*"
      ],
      "Condition": {
        "StringLike": {
          "events:ManagedBy": "malware-protection-plan.guardduty.amazonaws.com"
        }
      }
    },
    {
      "Sid": "AllowGuardDutyToMonitorEventBridgeManagedRule",
      "Effect": "Allow",
      "Action": [
        "events:DescribeRule",
        "events:ListTargetsByRule"
      ],
      "Resource": [
        "arn:aws:events:ap-southeast-1:381492162967:rule/DO-NOT-DELETE-AmazonGuardDutyMalwareProtectionS3*"
      ]
    },
    {
      "Sid": "AllowPostScanTag",
      "Effect": "Allow",
      "Action": [
        "s3:PutObjectTagging",
        "s3:GetObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:GetObjectVersionTagging"
      ],
      "Resource": [
        "arn:aws:s3:::<bucket_name>/*"
      ]
    },
    {
      "Sid": "AllowEnableS3EventBridgeEvents",
      "Effect": "Allow",
      "Action": [
        "s3:PutBucketNotification",
        "s3:GetBucketNotification"
      ],
      "Resource": [
        "arn:aws:s3:::<bucket_name>"
      ]
    },
    {
      "Sid": "AllowPutValidationObject",
      "Effect": "Allow",
      "Action": [
        "s3:PutObject"
      ],
      "Resource": [
        "arn:aws:s3:::<bucket_name>/malware-protection-resource-validation-object"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::<bucket_name>"
      ]
    },
    {
      "Sid": "AllowMalwareScan",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:GetObjectVersion"
      ],
      "Resource": [
        "arn:aws:s3:::<bucket_name>/*"
      ]
    },
    {
      "Sid": "AllowDecryptForMalwareScan",
      "Effect": "Allow",
      "Action": [
        "kms:GenerateDataKey",
        "kms:Decrypt"
      ],
      "Resource": "arn:aws:kms:ap-southeast-1:381492162967:key/<key_id>",
      "Condition": {
        "StringLike": {
          "kms:ViaService": "s3.*.amazonaws.com"
        }
      }
    }
  ]
}
```
- Trusted Relationship:
```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "malware-protection-plan.guardduty.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```
![](/images/3.GuardDuty/3.9-policy.jpg?width=60pc)

{{% notice note %}}
Hãy chắc chắn lưu lại các chi tiết quyền hạn để sử dụng sau này, rồi tiếp tục đến các phần tiếp theo.
{{% /notice %}}
